<app-header></app-header>
<div class="container">
  <div class="header">

    <div class="heading">
      <span class="heading__name">{{_reasonCode.currentProject?_reasonCode.currentProject.clientName:''}}</span>
      <span class="heading__divider"> | </span>
      <span class="heading__id">{{_reasonCode.currentProject?_reasonCode.currentProject.title:''}}</span>
    </div>

    <div class="middle header__btn">
      <button class="btn btn-flat-blue btn-lg clearfill" (click)="onOpenAddSprint()">ADD/EDIT SPRINT</button>
    </div>
  </div>
</div>

<div class="flex charts">
  <app-charts [options]="currentSprintOptions" [data]="_reasonCode.totalSprintData" [title]="'Project Status'"></app-charts>
  <app-charts [options]="currentSprintOptions" [data]="_reasonCode.currentSprintData" [title]="'Current Sprint'" [selectOptions]="_reasonCode.sprintConfig"></app-charts>
  <app-charts [title]="'FTE'"></app-charts>
</div>

<div class="flex table">
  <mat-tab-group>
    <mat-tab label="All U/S">
      <div class="flex">
        <app-table [sprint]="_reasonCode.sprintConfig"></app-table>
      </div>
    </mat-tab>
    <mat-tab label="Deleted U/S" (click)="onSelectDeletedUS()">
      <div class="flex">
        <app-delete-table></app-delete-table>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>


<!-- Create new sprint -->
<div class="overlay animate-scale" [ngClass]="{'animate-scale-active':openAddSprint}">
  <div class="modal">
    <div class="header">
      <span>Add Sprints</span>
      <span (click)="onCloseAddSprint()"><i class="fas fa-times"></i></span>
    </div>
    <div class="modal-table">
      <table>
        <thead>
          <tr>
            <th>Sprint#</th>
            <th>Name</th>
            <th>Start Date</th>
            <th>Duration</th>
            <th>End Date</th>
            <th class="sprint-close"></th>
          </tr>
        </thead>
        <tbody *ngIf="_reasonCode.sprintConfig">

            <tr [id]="sprint.id" *ngFor="let sprint of _reasonCode.sprintConfig">
              <td>Sprint#</td>
              <td>
                <input class="text-box" type="text" [(ngModel)]="sprint.sprint_name" (keyup)="onEditSprint($event, sprint.id, sprint)">
              </td>
              <td class="p-relative">
                <input class="text-box date" [matDatepicker]="picker" type="text" placeholder="Choose a date" [value]="sprint.start_date" (ngModelChange)="onEditSprint($event, sprint.id, sprint)" readonly>
                <div class="p-absolute date-picker-pos">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </div>
              </td>
              <td>
                <input class="text-box" type="text" [(ngModel)]="sprint.duration" (keyup)="onEditSprint($event, sprint.id, sprint)">
              </td>
              <td>
                <input class="text-box" type="text" [(ngModel)]="sprint.end_date" (keyup)="onEditSprint($event, sprint.id, sprint)">
              </td>
              <td (click)="onDeleteSprint(sprint.id)" class="sprint-close">
                <i class="fas fa-times"></i>
              </td>
            </tr>

            <tr>
              <td>Sprint#</td>
              <td><input class="text-box" type="text" [(ngModel)]="addSprintPayload.sprint_name" placeholder="Sprint Name" (keyup)="validateSprint(addSprintPayload)"></td>
              <td class="p-relative">
                <input class="text-box date" [matDatepicker]="picker" type="text" placeholder="Choose a date" [(ngModel)]="addSprintPayload.start_date" readonly [disabled]="validateSprintConfig.start_date" (click)="validateSprint(addSprintPayload)">
                <div class="p-absolute date-picker-pos">
                  <mat-datepicker-toggle matSuffix [for]="picker" (click)="validateSprint(addSprintPayload)"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </div>
              </td>
              <td>
                <div class="p-relative">
                  <input class="text-box p-absolute p-duration p-left" type="text" [(ngModel)]="addSprintPayload.duration" readonly placeholder="Weeks" [disabled]="validateSprintConfig.duration">
                  <div class="arrow">
                    <button (click)="onArrowUp()" [disabled]="validateSprintConfig.duration"><i class="fas fa-caret-up"></i></button>
                    <button (click)="onArrowDown()" [disabled]="validateSprintConfig.duration"><i class="fas fa-caret-down"></i></button>
                  </div>
                </div>
              </td>
              <td>
                <input class="text-box" type="text" [(ngModel)]="addSprintPayload.end_date" readonly placeholder="End Date" [disabled]="validateSprintConfig.end_date">
              </td>
              <td class="sprint-close"> </td>
            </tr>
          
          
        </tbody>
      </table>
    </div>
    <div class="add-btn">
      <button class="btn btn-flat-blue btn-flat-ash" (click)="onSaveSprint()">ADD SPRINT</button>
    </div>
    <div class="footer">
      <div class="flex flex-wrapper">
        <button class="btn btn-flat-blue btn-blue btn-primary" (click)="onCloseAddSprint()">OK</button>
        <button class="btn btn-flat-grey btn-primary" (click)="onCloseAddSprint()">CANCEL</button>
      </div>
    </div>
  </div>
</div>



<div class="overlay opacity" *ngIf="_reasonCode.movemodal">
  <div id="move-user-story">
    <div class="modal">
      <div class="header">
        <span>Move User Story</span>
        <span><i class="fas fa-times"></i></span>
      </div>
      <div class="sub-header">Drag & Drop U/S from one box to another</div>

      <div class="move-box flex">
        <div class="banner">
          <div class="dropdown">
            <app-select [placeholder]="'Select'" [options]="options"></app-select>
          </div>
          <div class="drag-box">
              <div
              cdkDropList
              #todoList="cdkDropList"
              [cdkDropListData]="todo"
              [cdkDropListConnectedTo]="[doneList]"
              class="example-list"
              (cdkDropListDropped)="drop($event)">
                <div class="example-box" *ngFor="let item of todo" cdkDrag>{{item}} <span><i class="fas fa-arrows-alt"></i></span></div>
              </div>
          </div>
        </div>
        
        <div class="banner">
          <div class="dropdown">
            <app-select [placeholder]="'Select'" [options]="options"></app-select>
          </div>
          <div class="drag-box">
              <div
              cdkDropList
              #doneList="cdkDropList"
              [cdkDropListData]="done"
              [cdkDropListConnectedTo]="[todoList]"
              class="example-list"
              (cdkDropListDropped)="drop($event)">
                <div class="example-box" *ngFor="let item of done" cdkDrag>{{item}} <span><i class="fas fa-arrows-alt"></i></span></div>
              </div>
          </div>
        </div>

      </div>

      <div class="footer">
        <div class="footer-note">
            *Note: You can only move U/S for the same clients only
        </div>

        <div class="footer-buttons flex">
          <button class="btn btn-flat-blue btn-blue">OK</button>
          <button class="btn btn-flat-grey" (click)="onCancel()">CANCEL</button>
        </div>
      </div>
    </div>
  </div>
</div>