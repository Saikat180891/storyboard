<div class="universal">
  <div class="container">
    <div class="header">
      <div class="heading-left-component" *ngIf="_reasonCode.currentProject">
        <app-project-header-title
          [projectTitle]="_reasonCode"
        ></app-project-header-title>
      </div>
      <div class="heading-right-component">
        <div class="controls-wrapper">
          <stb-button
            btnStyle="icon"
            (click)="onOpenAddSprint()"
            btnName="Config Project"
            btnColor="primary"
            htmlIcon="<i class='fas fa-cog'></i>"
          ></stb-button>
        </div>
        <div class="controls-wrapper">
          <stb-button
            btnStyle="icon"
            (click)="onOpenExport()"
            btnName="Export"
            btnColor="primary"
            htmlIcon="<i class='fas fa-file-export'></i>"
          ></stb-button>
        </div>
      </div>
    </div>
    <div class="chart-section">
      <div class="chart">
        <app-charts
          [extras]="false"
          [projectStatus]="_reasonCode.totalProjectStatus"
          [meter]="true"
          [options]="pieChartOptions"
          [data]="_reasonCode.totalSprintData"
          [title]="'Project Status'"
        ></app-charts>
      </div>
      <div class="chart">
        <app-charts
          [extras]="true"
          [projectStatus]="_reasonCode.currentSprintDuration"
          [meter]="true"
          [options]="pieChartOptions"
          [data]="_reasonCode.currentSprintData"
          [title]="'Current Sprint'"
          [selectOptions]="_reasonCode.sprintConfig"
        ></app-charts>
      </div>
      <div class="chart">
        <app-charts
          [extras]="false"
          [projectStatus]="_reasonCode.totalProjectStatus"
          [meter]="false"
          [options]="barChartOptions"
          [title]="'Benefits'"
          [data]="_reasonCode.benefitsChartData"
          [ifButtonRequired]="true"
          (onClick)="onShowBenefits($event)"
        ></app-charts>
      </div>
    </div>
  </div>
  <div class="userstory-container">
    <div class="menubar">
      <app-userstory-menu-bar
        (tabChange)="selectedTab = $event"
        (controlSelected)="onControlChange($event)"
      ></app-userstory-menu-bar>
      <div class="sort-menu-group" *ngIf="sortBy">
        <app-sort (close)="sortBy = !sortBy"></app-sort>
      </div>
      <div class="filter" *ngIf="filter">
        <userstory-filter
          (closeFilter)="filter = $event"
          *ngIf="clearAllFilter"
        ></userstory-filter>
      </div>
    </div>
    <div class="tabs" [ngSwitch]="selectedTab">
      <div id="open-user-story" *ngSwitchCase="0">
        <div class="filter-selected" *ngIf="_reasonCode.filteredValues.length">
          <mat-chip-list>
            <mat-chip
              *ngFor="
                let filteredValue of _reasonCode.filteredValues;
                let i = index
              "
            >
              {{ filteredValue }}
              <i
                class="fas fa-times-circle badge-close"
                (click)="onRemoveFilter(filteredValue, i)"
              ></i>
            </mat-chip>
          </mat-chip-list>
          <button class="btn reset-filter" (click)="onClearAllFilters()">
            Clear all filters
          </button>
        </div>
        <ng-container
          *ngIf="_reasonCode.userStories.length; else noOpenUserStory"
        >
          <div
            class="card-holder"
            [ngClass]="{
              'card-holder-active': fixToTop,
              'userstory-slide-left': openCreateSideBar
            }"
            *ngIf="_reasonCode.userStories.length"
            #userStoryContainer
          >
            <app-userstory-card
              (deleteUserStory)="onDeleteUserStory($event)"
              [restore]="false"
              [disableDeleteBtn]="true"
              *ngFor="let userStory of _reasonCode.userStories"
              [userStory]="userStory"
              (editUserStory)="onEditUserstory($event, userStory)"
            ></app-userstory-card>
          </div>
        </ng-container>
        <ng-template #noOpenUserStory>
          <div
            class="card-holder user-story-placeholder"
            *ngIf="_reasonCode.userStories.length == 0"
          >
            <img
              width="40px"
              height="40px"
              src="../../../assets/pics/open_user_story.svg"
              alt="placeholder"
            />
            <p>Get started by creating user stories & sprints</p>
          </div>
        </ng-template>
      </div>
      <div id="completed-user-story" *ngSwitchCase="1">
        <div class="filter-selected" *ngIf="_reasonCode.filteredValues.length">
          <mat-chip-list>
            <mat-chip
              *ngFor="
                let filteredValue of _reasonCode.filteredValues;
                let i = index
              "
            >
              {{ filteredValue }}
              <i
                class="fas fa-times-circle badge-close"
                (click)="onRemoveFilter(filteredValue, i)"
              ></i>
            </mat-chip>
          </mat-chip-list>
          <button class="btn reset-filter" (click)="onClearAllFilters()">
            Clear all filters
          </button>
        </div>
        <div class="info">
          <img
            src="../../../assets/pics/info_logo.svg"
            height="23px"
            width="23px"
          />
          <div class="info_text">
            To re-open a user story, change its status from "Done" to another
            state and assign to an open/future sprint.
          </div>
        </div>
        <ng-container
          *ngIf="
            _reasonCode.completeUserStories.length;
            else noCompletedUserstory
          "
        >
          <div class="card-holder">
            <app-userstory-card
              [restore]="false"
              [disableDeleteBtn]="false"
              *ngFor="let userStory of _reasonCode.completeUserStories"
              [userStory]="userStory"
              (editUserStory)="onOpenUserStorySidebar($event, userStory)"
            ></app-userstory-card>
          </div>
        </ng-container>
        <ng-template #noCompletedUserstory>
          <div class="no-userstory">
            <span>No Completed userstory</span>
          </div>
        </ng-template>
      </div>
      <div id="deleted-user-story" *ngSwitchCase="2">
        <div
          class="filter-selected"
          *ngIf="_reasonCode.filteredValues.length > 0"
        >
          <mat-chip-list>
            <mat-chip
              *ngFor="
                let filteredValue of _reasonCode.filteredValues;
                let i = index
              "
            >
              {{ filteredValue }}
              <i
                class="fas fa-times-circle badge-close"
                (click)="onRemoveFilter(filteredValue, i)"
              ></i>
            </mat-chip>
          </mat-chip-list>
          <button class="btn reset-filter" (click)="onClearAllFilters()">
            Clear all filters
          </button>
        </div>
        <ng-container
          *ngIf="
            _reasonCode.deletedUserStories.length;
            else noDeletedUserstories
          "
        >
          <div class="card-holder">
            <app-userstory-card
              [restore]="true"
              [disableEdit]="true"
              *ngFor="let userStory of _reasonCode.deletedUserStories"
              [userStory]="userStory"
              (editUserStory)="onOpenUserStorySidebar($event, userStory)"
            ></app-userstory-card>
          </div>
        </ng-container>
        <ng-template #noDeletedUserstories>
          <div class="no-userstory">
            <span>No deleted userstory</span>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <div
    class="transparent-overlay"
    [ngClass]="{ 'transparent-overlay-active': openCreateSideBar }"
  >
    <div
      class="side-modal"
      [ngClass]="{ 'side-modal-active': openCreateSideBar }"
    >
      <app-userstory-card-create
        *ngIf="openCreateSideBar"
        [reasonCodeOptions]="reasonCodeOptions"
        [sprintOptions]="sprintOptions"
        (close)="onCloseCreateUserStories($event)"
      ></app-userstory-card-create>
    </div>
  </div>
  <div
    class="transparent-overlay"
    [ngClass]="{ 'transparent-overlay-active': openEditSideBar }"
  >
    <div
      class="side-modal"
      [ngClass]="{ 'side-modal-active': openEditSideBar }"
    >
      <app-userstory-card-edit
        [reasonCodeOptions]="reasonCodeOptions"
        (warning)="onDoneWarning($event)"
        *ngIf="openEditSideBar"
        (close)="onCloseEditUserStories($event)"
        [editUSData]="userStoryData"
        [sprintOptions]="sprintOptions"
      ></app-userstory-card-edit>
    </div>
  </div>
</div>
<div
  class="overlay"
  [ngClass]="{ 'overlay-show': warning, 'overlay-hide': !warning }"
>
  <div class="warning">
    <p>Are you sure you want to move it to <strong>Completed</strong>?</p>
    <div class="btn-group">
      <button class="btn btn-blue" (click)="onSelectYes()">Yes</button>
      <button class="btn btn-flat-ash" (click)="onSelectNo()">No</button>
    </div>
  </div>
</div>
<div
  class="overlay"
  [ngClass]="{ 'overlay-show': openAddSprint, 'overlay-hide': !openAddSprint }"
>
  <div class="sprint-config-modal" *ngIf="openAddSprint">
    <project-config
      [reasonCodeConfigData]="_reasonCode.reasonCodeData"
      (closeSprints)="onCloseProjectConfig($event)"
    ></project-config>
  </div>
</div>
<div
  class="overlay"
  [ngClass]="{
    'overlay-show': warningToDeleteUserStory,
    'overlay-hide': !warningToDeleteUserStory
  }"
>
  <div class="warning">
    <p>Are you sure you want to delete this user story?</p>
    <div class="btn-group">
      <button class="btn btn-blue" (click)="onSelectDeleteUserStory()">
        Yes
      </button>
      <button class="btn btn-flat-ash" (click)="onSelectDoNotDeleteUserStory()">
        No
      </button>
    </div>
  </div>
</div>
<div
  class="overlay"
  [ngClass]="{
    'overlay-show': showBenefitsChart,
    'overlay-hide': !showBenefitsChart
  }"
>
  <div class="benefits-frame">
    <img [src]="benefitChartImage" alt="" />
    <div class="frame-close" (click)="onCloseBenefits()">
      <i class="fas fa-times" (click)="onCloseBenefits()"></i>
    </div>
  </div>
</div>
<ngx-spinner
  bdColor="rgba(56, 73, 109,0.8)"
  size="medium"
  color="#fff"
  type="ball-spin-clockwise"
  class="myspinner"
>
</ngx-spinner>
