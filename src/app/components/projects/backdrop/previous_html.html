<div class="overlay" *ngIf="_UIControllerService.getOverlay()" (click)="onOverlayClose()" @slideDown>

        <!-- This is for editing new SOP -->
            <div 
            class="dialog" 
            (keydown.esc)="onEscape($event)" 
            (click)="preventPropagation($event)" 
            [formGroup]="sopForm"
            >
        
              <div class="dialog-group border padding-all color-main-blue">
                <div class="dialog-element">
                  <span *ngIf="_UIControllerService.getOverlayHeader()==createSOP">{{createSOP}}</span>
                  <span *ngIf="_UIControllerService.getOverlayHeader()==editSOP">{{editSOP}}</span>
                  <span class="close" (click)="onClose()"><i class="fas fa-times"></i></span>
                </div>
              </div>
        <!-- ---------------------------------------------------------client name--------------------------------------------------------------------------------------------------- -->
              <div class="dialog-group padding-all margin-top-10 margin-bottom-10">
                  <div class="input-box">
                    <input 
                      *ngIf="_UIControllerService.getOverlayHeader()==createSOP"
                      id="clientName"
                      type="text" 
                      [ngClass]="{'ASN-box':true, 'validators':validateClientName===true}" 
                      placeholder="Client Name" 
                      required 
                      formControlName="clientName"
                    >
        
                    <input 
                      *ngIf="_UIControllerService.getOverlayHeader()==editSOP"
                      id="clientName"
                      type="text" 
                      [ngClass]="{'ASN-box':true, 'validators':validateClientName===true}" 
                      placeholder="Client Name" 
                      required 
                      formControlName="clientName" 
                      [appCanAccess]="{
                        role:permissions.role, 
                        permissionRequired:'Can change sop',
                        permissionList: permissions.permissions,
                        action: 'disable'
                      }"
                    >
        
                  </div>
                  <small [ngClass]="{'validation-message':validateClientName}" *ngIf="validateClientName">
                    <em>{{validateClientNameMessage}}</em>
                  </small>
                  
              </div>
        <!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
              <div class="dialog-group padding-all margin-bottom-10">
                  <div class="input-box">
                      <input 
                      *ngIf="_UIControllerService.getOverlayHeader()==createSOP"
                      type="text" 
                      [ngClass]="{'ASN-box':true, 'validators':validateAutomationSystemName===true}" 
                      placeholder="Automation System Name" 
                      required 
                      formControlName = "title" 
                      >
        
                      <input 
                      *ngIf="_UIControllerService.getOverlayHeader()==editSOP"
                      type="text" 
                      [ngClass]="{'ASN-box':true, 'validators':validateAutomationSystemName===true}" 
                      placeholder="Automation System Name" 
                      required 
                      formControlName="title"
                      maxlength="50" 
                      [appCanAccess]="{
                        role:permissions.role, 
                        permissionRequired:'Can change sop', 
                        permissionList: permissions.permissions,
                        action: 'disable'
                      }"
                      >
        
                  </div>
                  <small [ngClass]="{'validation-message':validateAutomationSystemName===true}" *ngIf="validateAutomationSystemName">
                    <em>{{validateAutomationSystemNameMessage}}</em>
                  </small>
              </div>
        <!-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
              <div class="dialog-group padding-all margin-bottom-10">
                  <div class="input-box">
                      <input 
                      *ngIf="_UIControllerService.getOverlayHeader()==createSOP"
                      type="text" 
                      id="charge-code" 
                      placeholder="Charge Code" 
                      required 
                      formControlName = "chargeCode"
                      [ngClass]="{'validators':validateChargeCode===true}" maxlength="50">
        
                      <input 
                      *ngIf="_UIControllerService.getOverlayHeader()==editSOP"
                      type="text" 
                      id="charge-code" 
                      placeholder="Charge Code" 
                      required 
                      formControlName = "chargeCode"
                      [ngClass]="{'validators':validateChargeCode===true}" 
                      [appCanAccess]="{
                        role:permissions.role, 
                        permissionRequired:'Can change sop', 
                        permissionList: permissions.permissions,
                        action: 'disable'
                      }"
                      >
        
        <!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
                      <ng-container *ngIf="_UIControllerService.getOverlayHeader()==createSOP">
                        <input
                          id="date" 
                          placeholder="Due Date" 
                          type="text"
                          matInput 
                          [matDatepicker]="picker" 
                          required 
                          readonly  
                          formControlName = "due_date"
                          [ngClass]="{'validators':validateChargeCode===true}"
                          [ngStyle]="{'border':validateChargeCode?border:false}"
                        >
                        <div class="datepicker">
                          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker>
                        </div>
                      </ng-container>
                      <ng-container *ngIf="_UIControllerService.getOverlayHeader()==editSOP">
                        <input
                          id="date" 
                          placeholder="Due Date" 
                          type="text"
                          matInput 
                          [matDatepicker]="picker" 
                          required 
                          readonly  
                          formControlName = "due_date"
                          [ngClass]="{'validators':validateChargeCode===true}"
                          [ngStyle]="{'border':validateChargeCode?border:false}"
                        >
                        <div class="datepicker" 
                        [appCanAccess]="{
                          role:permissions.role, 
                          permissionRequired:'Can change sop', 
                          permissionList: permissions.permissions
                        }">
                          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                          <mat-datepicker #picker></mat-datepicker>
                        </div>
                      </ng-container>
                  </div>
                  <small 
                    [ngClass]="{'validation-message':validateChargeCode===true||validateSelectedDate===true}" 
                    *ngIf="validateChargeCode||validateSelectedDate">
                      <em>{{validateChargeCodeMessage}}</em>
                  </small>
        <!-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
              </div>
        
              <div class="dialog-group padding-all upload height-auto">
                <div class="relative pointer">
                  <button mat-stroked-button>
                    <img class="preview-logo" *ngIf="filePreview" [src]="filePreview" [alt]="filePreview">
                    <span class="client-logo" *ngIf="!filePreview">Upload Client Logo</span>
                    <span *ngIf="!filePreview"><small>(Max Size 200px-200px)</small></span>
                    <span *ngIf="!filePreview"><i class="fas fa-download"></i>CHOOSE FILE</span>
                  </button>
        
                  <input 
                  *ngIf="_UIControllerService.getOverlayHeader()==createSOP"
                  type="file" 
                  (change)="onFileSelected($event)"/>
        
                  <input 
                  *ngIf="_UIControllerService.getOverlayHeader()==editSOP"
                  type="file" 
                  (change)="onFileSelected($event)"
                  [appCanAccess]="{
                    role:permissions.role, 
                    permissionRequired:'Can change sop', 
                    permissionList: permissions.permissions
                  }"/>
                </div>
              </div>
        <!-- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
              <div class="dialog-group padding-all height-auto padding-top-0" id="add-assign">
                  <div class="input-box padding-top-0 relative">
                    <label for="ASN-box">Assign To</label>
        
                    <ng-container *ngIf="_UIControllerService.getOverlayHeader()==createSOP">
                      <input 
                      type="text" 
                      placeholder="Type name or email address" 
                      (keyup)="onKeyPress($event)">
                      <div 
                      class="autocomplete" 
                      *ngIf="options; else load">
                        <ng-container *ngFor="let option of options; let i=index">
                          <span class="autocomplete-item" (click)="onSelect(option)">{{option.email}}</span>
                        </ng-container>
                      </div>
                    </ng-container>
        
                    <ng-container *ngIf="_UIControllerService.getOverlayHeader()==editSOP">
                      <input 
                      type="text" 
                      placeholder="Type name or email address" 
                      (keyup)="onKeyPress($event)"
                      [appCanAccess]="{
                        role:permissions.role, 
                        permissionRequired:'Can add assignee', 
                        permissionList: permissions.permissions,
                        action: 'disable'
                      }">
                      <div 
                      class="autocomplete" 
                      *ngIf="options; else load" 
                      [appCanAccess]="{
                        role:permissions.role, 
                        permissionRequired:'Can add assignee', 
                        permissionList: permissions.permissions
                      }">
                        <ng-container *ngFor="let option of options; let i=index">
                          <span class="autocomplete-item" (click)="onSelect(option)">{{option.email}}</span>
                        </ng-container>
                      </div>
                    </ng-container>
        
                      <!-- <button (click)="addAssignee()">ADD</button> -->
                  </div>
              </div>
        
              <div class="dialog-group padding-all height-auto height-max margin-bottom-10">
                  <ul *ngIf="_UIControllerService.getOverlayHeader()==editSOP && userDatas">
                    <li *ngFor="let userData of createdAssignees; let i=index" @hideInOut>
                      <div class="horizontal-flex">
                        <img [src]="" [alt]=""/>
                        <span *ngIf="userData.user">{{userData.user}}</span>
                        <span *ngIf="userData.email">{{userData.email}}</span>
                        <div class="select-role">
                          <mat-select placeholder=" Assign role" (selectionChange)="onSelectionChange($event.value, i)" disabled=true>
                              <mat-option *ngFor="let role of roles" [value]="role">
                              {{role}}
                              </mat-option>
                          </mat-select>
                        </div>
                        <ng-container *ngIf="_UIControllerService.getOverlayHeader()==createSOP">
                            <span 
                            class="list-close" 
                            (click)="onRemove(userData.id)">
                              <i class="fas fa-times"></i>
                            </span>
                        </ng-container>
                        <ng-container *ngIf="_UIControllerService.getOverlayHeader()==editSOP">
                          <span 
                          class="list-close" 
                          (click)="onRemove(userData.id)" 
                          [appCanAccess]="{
                            role:permissions.role, 
                            permissionRequired:'Can delete assignee', 
                            permissionList: permissions.permissions
                          }">
                            <i class="fas fa-times"></i>
                          </span>
                        </ng-container> 
                      </div>
                    </li>
                  </ul>
              </div>
        <!-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
              <div class="dialog-group-2 padding-all fixed-bottom height-auto margin-bottom-10">
                <div class="button-box">
                    <button 
                    *ngIf="_UIControllerService.getOverlayHeader()==createSOP" 
                    mat-raised-button 
                    color="primary" 
                    (click)="onCreateNew()" 
                    >CREATE NEW</button>
        
                    <button 
                    *ngIf="_UIControllerService.getOverlayHeader()==editSOP" 
                    mat-raised-button 
                    color="primary" 
                    (click)="onSave()" 
                    [appCanAccess]="{
                      role:permissions.role, 
                      permissionRequired:'Can change sop', 
                      permissionList: permissions.permissions
                    }">SAVE</button>
        
                    <button mat-raised-button (click)="onClose()">CANCEL</button>
                </div>
              </div>
        
            </div>
        <!-- ------------------------------------------------------------------------------------- -->
        <app-preloader></app-preloader>
        <!-- ------------------------------------------------------------------------------------- -->
          </div>
            
        